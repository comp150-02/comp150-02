#!/bin/sh
# Change this line if you cloned the course repository someplace else
export COURSE_REPO=~/course-repo
cd ~/

# TODO: Setup zsh

# Installing virtualenv for installing and managing python packages
# for the local user (you)
# To learn more check out : http://docs.python-guide.org/en/latest/dev/virtualenvs/
pip install virtualenv
# Installing virtualenvwrapper to handel ENV vars
pip install virtualenvwrapper
mkdir ~/Envs
export WORKON_HOME=~/Envs
source /usr/local/bin/virtualenvwrapper.sh

# Make a virtualenv for this class
mkvirtualenv deep-venv
# This makes it so when you run 'workon deep-venv' the virtualenv is
# started and you cd into this course's rep
echo 'cd /home/$USER/course-repo' >> ~/Envs/deep-venv/bin/postactivate
workon deep-venv
# Note: to get out of a virtualenv run command deactivate

# Get Caffe
cd ~/
git clone https://github.com/BVLC/caffe.git
cp $COURSE_REPO/bin/caffe_Makefile.config caffe/Makefile.config

# Install python dependencies
cd caffe/python
for req in $(cat pip_freeze); do sudo pip install $req; done

# Install Jupyter notebook app for in-browser coding
pip install -r jupyter

# Install caffe
echo "export LD_LIBRARY_PATH=/usr/lib64/" >> ~/.bashrc
echo "export PYTHONPATH=~/caffe/python:$PYTHONPATH" >> ~/.bashrc
source ~/.bashrc
cd ..
make all
make test
make runtest
make distribute

# check that everything works
python -c "import caffe"
