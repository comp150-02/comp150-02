#!/bin/sh
# Change this line if you cloned the course repository someplace else
export COURSE_REPO=~/course-repo
cd ~/

# TODO: Setup zsh

# Installing virtualenv for installing and managing python packages
# for the local user (you)
# To learn more check out : http://docs.python-guide.org/en/latest/dev/virtualenvs/
# pip install virtualenv
# # Installing virtualenvwrapper to handel ENV vars
# pip install virtualenvwrapper
mkdir ~/Envs
echo "export WORKON_HOME=~/Envs" >> ~/.bashrc
echo "source /usr/bin/virtualenvwrapper.sh" >> ~/.bashrc
source ~/.bashrc

# Make a virtualenv for this class
mkvirtualenv deep-venv
# This makes it so when you run 'workon deep-venv' the virtualenv is
# started and you cd into this course's rep
echo 'cd $COURSE_REPO' >> ~/Envs/deep-venv/bin/postactivate

# Note: to get out of a virtualenv run command deactivate
# Checking that the virtual env works
deactivate
workon deep-venv


# Install python math and science packages
pip install numpy 
pip install scipy
pip install matplotlib

# Install Jupyter notebook app for in-browser coding
pip install jupyter

# Install other course python requirements
cd $COURSE_REPO/bin
pip install -r requirements.txt


# Get Caffe
cd ~/
git clone https://github.com/BVLC/caffe.git
cp $COURSE_REPO/bin/aws_caffe_Makefile.config ~/caffe/Makefile.config

# Install python dependencies
cd caffe/python
pip install numpy
pip install scipy
pip install -r requirements.txt

# Install caffe
echo "export LD_LIBRARY_PATH=/usr/lib64/" >> ~/.bashrc
echo "export PYTHONPATH=~/caffe/python:$PYTHONPATH" >> ~/.bashrc
source ~/.bashrc
cd ..
make all
make test
make runtest
make distribute

# check that everything works
python -c "import caffe"
